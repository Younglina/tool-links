import{r as k,o as Z,d as xe,a as P,c as r,b as l,e,w as G,f as L,v as Y,g as ce,h as N,i as ee,n as F,T as H,j as J,k as Q,l as V,m as de,p as j,t as K,F as O,q as W,s as le,u as D,x as X,y as ge,z as _e,A as Te,B as re,C as Ae,D as Fe}from"./vue-vendor-BcVkKEzE.js";import{X as Ue}from"./dexie-2jmnBxhj.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))d(m);new MutationObserver(m=>{for(const f of m)if(f.type==="childList")for(const p of f.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function n(m){const f={};return m.integrity&&(f.integrity=m.integrity),m.referrerPolicy&&(f.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?f.credentials="include":m.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(m){if(m.ep)return;m.ep=!0;const f=n(m);fetch(m.href,f)}})();const Ke=()=>{const s=k("neumorphism"),c=d=>{s.value=d,document.documentElement.setAttribute("data-theme",d),localStorage.setItem("theme",d)},n=()=>{const d=localStorage.getItem("theme");c(d==="neumorphism"?d:"neumorphism")};return Z(()=>{n()}),{currentTheme:s,setTheme:c}},ye=xe("app",()=>{const s=k({categoryId:null,tagIds:[],searchQuery:""});return{filter:s,setCategoryId:p=>{s.value.categoryId=p},setTagIds:p=>{s.value.tagIds=p},toggleTagId:p=>{const u=s.value.tagIds.indexOf(p);u===-1?s.value.tagIds.push(p):s.value.tagIds.splice(u,1)},setSearchQuery:p=>{s.value.searchQuery=p.toLowerCase()},resetFilter:()=>{s.value={categoryId:null,tagIds:[],searchQuery:""}}}}),Le={class:"search-bar"},Se=P({__name:"SearchBar",setup(s){const c=ye(),n=k(""),d=()=>{c.setSearchQuery(n.value)},m=()=>{n.value="",c.setSearchQuery("")};return(f,p)=>(l(),r("div",Le,[p[2]||(p[2]=e("i",{class:"mdi mdi-magnify search-icon"},null,-1)),G(e("input",{"onUpdate:modelValue":p[0]||(p[0]=u=>n.value=u),type:"text",placeholder:"搜索工具...",class:"search-input",onInput:d},null,544),[[Y,n.value]]),n.value?(l(),r("button",{key:0,onClick:m,class:"clear-btn"},[...p[1]||(p[1]=[e("i",{class:"mdi mdi-close-circle"},null,-1)])])):L("",!0)]))}}),z=(s,c)=>{const n=s.__vccOpts||s;for(const[d,m]of c)n[d]=m;return n},Re=z(Se,[["__scopeId","data-v-97e50a27"]]);class Oe extends Ue{websites;categories;tags;constructor(){super("SitesDB"),this.version(1).stores({websites:"++id, name, categoryId, createdAt",categories:"++id, name",tags:"++id, name"}),this.version(2).stores({websites:"++id, name, *categoryIds, createdAt",categories:"++id, name",tags:"++id, name"}).upgrade(c=>c.table("websites").toCollection().modify(n=>{n.categoryId!==void 0&&!n.categoryIds&&(n.categoryIds=n.categoryId?[n.categoryId]:[],delete n.categoryId)}))}}const x=new Oe;async function De(s){const c=new Uint8Array(s);let n="";for(let d=0;d<c.byteLength;d++)n+=String.fromCharCode(c[d]);return btoa(n)}async function Ne(s){const c=atob(s),n=new Uint8Array(c.length);for(let d=0;d<c.length;d++)n[d]=c.charCodeAt(d);return n.buffer}async function Me(){const s=await x.websites.toArray(),c=await x.categories.toArray(),n=await x.tags.toArray(),d={version:1,exportedAt:new Date().toISOString(),websites:await Promise.all(s.map(async u=>({...u,icon:u.icon?await De(u.icon):void 0}))),categories:c,tags:n},m=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),f=URL.createObjectURL(m),p=document.createElement("a");p.href=f,p.download=`tools-export-${new Date().toISOString().split("T")[0]}.json`,p.click(),URL.revokeObjectURL(f)}async function Be(s,c="merge"){const n=await s.text(),d=JSON.parse(n);c==="replace"&&(await x.websites.clear(),await x.categories.clear(),await x.tags.clear());const m=new Map,f=new Map,p=[];for(const a of d.categories){const g=await x.categories.where("name").equals(a.name).first();if(g)m.set(a.id,g.id),p.push(g.id);else{const w=await x.categories.add({name:a.name,iconName:a.iconName});typeof w=="number"&&(m.set(a.id,w),p.push(w))}}const u=[];for(const a of d.tags){const g=await x.tags.where("name").equals(a.name).first();if(g)f.set(a.id,g.id),u.push(g.id);else{const w=await x.tags.add({name:a.name,count:0});typeof w=="number"&&(f.set(a.id,w),u.push(w))}}const v=new Set((await x.websites.toArray()).map(a=>a.url));let i=0;for(const a of d.websites)v.has(a.url)||(await x.websites.add({name:a.name,url:a.url,icon:a.icon?await Ne(a.icon):void 0,iconMimeType:a.iconMimeType||"image/png",description:a.description,apiKeys:a.apiKeys||[],categoryIds:(a.categoryIds||[]).map(g=>m.get(g)||0),tagIds:(a.tagIds||[]).map(g=>f.get(g)||0),createdAt:a.createdAt?new Date(a.createdAt):new Date,updatedAt:a.updatedAt?new Date(a.updatedAt):new Date}),i++);return{websites:i,categories:p.length,tags:u.length}}const We={class:"header"},Ee={class:"header-content"},Ve={class:"header-center"},je={class:"header-right"},Pe={key:0,class:"dropdown-menu"},Qe={class:"dropdown-item"},ze={class:"modal-actions"},qe=P({__name:"Header",emits:["toggle-sidebar","action"],setup(s,{emit:c}){const n=c,d=k(!1),m=k(null),f=k(!1),p=k(!1),u=k(!1);let v=null;const i=()=>{n("toggle-sidebar")},a=()=>{d.value=!d.value},g=y=>{y==="export"?w():(d.value=!1,n("action",y))},w=async()=>{d.value=!1,p.value=!0;try{await Me()}catch(y){console.error("Failed to export:",y),alert("导出失败")}finally{p.value=!1}},o=y=>{const t=y.target,I=t.files?.[0];I&&(d.value=!1,v=I,u.value=!0,t.value="")},T=async y=>{if(v){u.value=!1,f.value=!0;try{const t=await Be(v,y);alert(`${y==="merge"?"合并":"替换"}成功！
新增网站: ${t.websites}
分类: ${t.categories}
标签: ${t.tags}`)}catch(t){console.error("Failed to import:",t),alert("导入失败")}finally{f.value=!1,v=null}}},h=y=>{m.value&&!m.value.contains(y.target)&&(d.value=!1)};return Z(()=>{document.addEventListener("click",h)}),ce(()=>{document.removeEventListener("click",h)}),(y,t)=>(l(),r("header",We,[e("div",Ee,[e("div",{class:"header-left"},[e("button",{onClick:i,class:"menu-btn lg:hidden"},[...t[10]||(t[10]=[e("i",{class:"mdi mdi-menu text-xl"},null,-1)])]),t[11]||(t[11]=e("div",{class:"logo"},[e("div",{class:"logo-icon"},[e("i",{class:"mdi mdi-robot-love-outline text-xl"})]),e("span",{class:"logo-text"},"工具集")],-1))]),e("div",Ve,[N(Re)]),e("div",je,[e("div",{class:"action-dropdown",ref_key:"dropdownRef",ref:m},[e("button",{onClick:a,class:"action-btn"},[t[12]||(t[12]=e("i",{class:"mdi mdi-plus"},null,-1)),t[13]||(t[13]=e("span",{class:"btn-text"},"添加",-1)),e("i",{class:F(["mdi mdi-chevron-down chevron",{rotate:d.value}])},null,2)]),N(H,{name:"dropdown"},{default:J(()=>[d.value?(l(),r("div",Pe,[e("button",{onClick:t[0]||(t[0]=I=>g("website")),class:"dropdown-item"},[...t[14]||(t[14]=[e("i",{class:"mdi mdi-web"},null,-1),e("span",null,"添加网站",-1)])]),e("button",{onClick:t[1]||(t[1]=I=>g("category")),class:"dropdown-item"},[...t[15]||(t[15]=[e("i",{class:"mdi mdi-folder-outline"},null,-1),e("span",null,"分类管理",-1)])]),e("button",{onClick:t[2]||(t[2]=I=>g("tag")),class:"dropdown-item"},[...t[16]||(t[16]=[e("i",{class:"mdi mdi-tag-outline"},null,-1),e("span",null,"标签管理",-1)])]),t[20]||(t[20]=e("div",{class:"dropdown-divider"},null,-1)),e("button",{onClick:t[3]||(t[3]=I=>g("export")),class:"dropdown-item"},[...t[17]||(t[17]=[e("i",{class:"mdi mdi-export"},null,-1),e("span",null,"导出数据",-1)])]),e("label",Qe,[t[18]||(t[18]=e("i",{class:"mdi mdi-import"},null,-1)),t[19]||(t[19]=e("span",null,"导入数据",-1)),e("input",{type:"file",accept:".json",onChange:o,onClick:t[4]||(t[4]=Q(()=>{},["stop"])),hidden:""},null,32)])])):L("",!0)]),_:1})],512),(l(),ee(de,{to:"body"},[u.value?(l(),r("div",{key:0,class:"modal-overlay",onClick:t[9]||(t[9]=I=>u.value=!1)},[e("div",{class:"modal-content",onClick:t[8]||(t[8]=Q(()=>{},["stop"]))},[t[24]||(t[24]=e("h3",{class:"modal-title"},"导入数据",-1)),t[25]||(t[25]=e("p",{class:"modal-desc"},"请选择导入方式：",-1)),e("div",ze,[e("button",{onClick:t[5]||(t[5]=I=>T("merge")),class:"modal-btn primary"},[...t[21]||(t[21]=[e("i",{class:"mdi mdi-merge"},null,-1),V(" 合并（跳过重复） ",-1)])]),e("button",{onClick:t[6]||(t[6]=I=>T("replace")),class:"modal-btn danger"},[...t[22]||(t[22]=[e("i",{class:"mdi mdi-replace"},null,-1),V(" 替换（清空现有数据） ",-1)])])]),e("button",{onClick:t[7]||(t[7]=I=>u.value=!1),class:"modal-close"},[...t[23]||(t[23]=[e("i",{class:"mdi mdi-close"},null,-1)])])])])):L("",!0)]))])])]))}}),Ge=z(qe,[["__scopeId","data-v-bca7346a"]]),He=k([]);let ne=!1;const te=()=>{const s=He,c=k(!1),n=async()=>{if(!ne){c.value=!0;try{s.value=await x.categories.toArray(),ne=!0}catch(u){console.error("Failed to load categories:",u)}finally{c.value=!1}}};return{categories:s,isLoading:c,loadCategories:n,addCategory:async u=>{try{await x.categories.add(u),ne=!1,await n()}catch(v){throw console.error("Failed to add category:",v),v}},updateCategory:async(u,v)=>{try{await x.categories.update(u,v),ne=!1,await n()}catch(i){throw console.error("Failed to update category:",i),i}},deleteCategory:async u=>{try{await x.categories.delete(u),ne=!1,await n()}catch(v){throw console.error("Failed to delete category:",v),v}},getCategoryById:async u=>await x.categories.get(u)}},Je=s=>new Promise((c,n)=>{const d=new FileReader;d.onload=()=>c(d.result),d.onerror=n,d.readAsArrayBuffer(s)}),Xe=(s,c)=>{const n=new Blob([s],{type:c});return URL.createObjectURL(n)},Ye=()=>{const s=k(null),c=k(null),n=k(!1),d=k(null),m=v=>{const a=v.target.files?.[0];a&&(s.value=a,f(a))},f=v=>{const i=URL.createObjectURL(v);c.value=i};return{selectedFile:s,previewUrl:c,isUploading:n,error:d,handleFileSelect:m,processFile:async()=>{if(!s.value)return null;n.value=!0,d.value=null;try{return{buffer:await Je(s.value),mimeType:s.value.type}}catch(v){return d.value="图片处理失败",console.error("Failed to process image:",v),null}finally{n.value=!1}},reset:()=>{c.value&&URL.revokeObjectURL(c.value),s.value=null,c.value=null,d.value=null}}},fe=k([]),ue=k(null),me=k(!1),we=()=>{const s=async()=>{me.value=!0;try{fe.value=await x.websites.toArray()}catch(p){console.error("Failed to load websites:",p)}finally{me.value=!1}};return{websites:fe,selectedWebsite:ue,isLoading:me,loadWebsites:s,addWebsite:async p=>{try{const u=new Date,v={...p,createdAt:u,updatedAt:u};await x.websites.add(v),await s()}catch(u){throw console.error("Failed to add website:",u),u}},updateWebsite:async(p,u)=>{try{const v={...u,categoryIds:u.categoryIds?[...u.categoryIds]:void 0,tagIds:u.tagIds?[...u.tagIds]:void 0,apiKeys:u.apiKeys?[...u.apiKeys]:void 0,updatedAt:new Date};await x.websites.update(p,v),await s()}catch(v){throw console.error("Failed to update website:",v),v}},deleteWebsite:async p=>{try{await x.websites.delete(p),await s()}catch(u){throw console.error("Failed to delete website:",u),u}},getWebsiteById:async p=>{try{return ue.value=await x.websites.get(p),ue.value}catch(u){return console.error("Failed to get website:",u),null}},getWebsiteIconUrl:p=>Xe(p.icon,p.iconMimeType)}},Ze={class:"category-filter"},et={class:"category-list"},tt={class:"category-count"},st=["onClick"],ot={class:"category-icon"},nt={class:"category-name"},at={class:"category-count"},lt=P({__name:"CategoryFilter",setup(s){const c=ye(),{categories:n,loadCategories:d}=te(),{websites:m,loadWebsites:f}=we();Z(async()=>{await Promise.all([d(),f()])});const p=j(()=>c.filter.categoryId),u=j(()=>m.value.length),v=j(()=>n.value.map(a=>({...a,count:m.value.filter(g=>(g.categoryIds||[]).includes(a.id)).length}))),i=a=>{c.setCategoryId(a)};return(a,g)=>(l(),r("div",Ze,[g[3]||(g[3]=e("h3",{class:"filter-title"},"分类",-1)),e("ul",et,[e("li",{onClick:g[0]||(g[0]=w=>i(null)),class:F(["category-item",p.value===null?"active":""])},[g[1]||(g[1]=e("div",{class:"category-icon"},[e("i",{class:"mdi mdi-apps"})],-1)),g[2]||(g[2]=e("span",{class:"category-name"},"全部",-1)),e("span",tt,K(u.value),1)],2),(l(!0),r(O,null,W(v.value,w=>(l(),r("li",{key:w.id,onClick:o=>i(w.id),class:F(["category-item",p.value===w.id?"active":""])},[e("div",ot,[e("i",{class:F(["mdi",`mdi-${w.iconName}`])},null,2)]),e("span",nt,K(w.name),1),e("span",at,K(w.count),1)],10,st))),128))])]))}}),it=z(lt,[["__scopeId","data-v-9e816649"]]),rt={class:"sidebar-content"},ct=P({__name:"Sidebar",props:{isOpen:{type:Boolean}},emits:["close"],setup(s){return(c,n)=>(l(),r("aside",{class:F(["sidebar",{open:s.isOpen}])},[e("div",rt,[N(it)])],2))}}),dt=z(ct,[["__scopeId","data-v-d5eef4ff"]]),ut=k([]);let ae=!1;const ie=()=>{const s=ut,c=k(!1),n=async()=>{if(!ae){c.value=!0;try{s.value=await x.tags.toArray(),ae=!0}catch(i){console.error("Failed to load tags:",i)}finally{c.value=!1}}};return{tags:s,isLoading:c,loadTags:n,addTag:async i=>{try{await x.tags.add(i),ae=!1,await n()}catch(a){throw console.error("Failed to add tag:",a),a}},updateTag:async(i,a)=>{try{await x.tags.update(i,a),ae=!1,await n()}catch(g){throw console.error("Failed to update tag:",g),g}},deleteTag:async i=>{try{await x.tags.delete(i),ae=!1,await n()}catch(a){throw console.error("Failed to delete tag:",a),a}},incrementTagCount:async i=>{try{const a=await x.tags.get(i);a&&await x.tags.update(i,{count:(a.count||0)+1})}catch(a){console.error("Failed to increment tag count:",a)}},decrementTagCount:async i=>{try{const a=await x.tags.get(i);a&&a.count>0&&await x.tags.update(i,{count:a.count-1})}catch(a){console.error("Failed to decrement tag count:",a)}},getTagById:async i=>await x.tags.get(i)}},mt={class:"card-actions"},pt=["href"],gt={class:"card-header"},yt={class:"card-icon-wrapper"},vt=["src","alt"],ft={key:1,class:"website-icon placeholder-icon"},bt={class:"card-info"},wt={class:"website-name"},ht={key:0,class:"category-tags"},kt={class:"description line-clamp-2"},Ct={key:0,class:"card-tags"},$t={key:0,class:"hash-tag more"},It=P({__name:"WebsiteCard",props:{website:{}},emits:["click","edit","delete"],setup(s,{emit:c}){const n=s,d=c,{categories:m,loadCategories:f}=te(),{tags:p,loadTags:u}=ie();Z(()=>{f(),u()});const v=j(()=>{if(!n.website.icon||n.website.icon.byteLength===0)return"";try{const h=new Blob([n.website.icon],{type:n.website.iconMimeType||"image/png"});return URL.createObjectURL(h)}catch(h){return console.error("Failed to create icon URL:",h),""}});j(()=>m.value.find(h=>(n.website.categoryIds||[]).includes(h.id)));const i=j(()=>(n.website.categoryIds||[]).map(h=>m.value.find(y=>y.id===h)?.name).filter(Boolean)),a=h=>p.value.find(t=>t.id===h)?.name||"",g=()=>{d("click")},w=()=>{d("edit")},o=()=>{confirm("确定要删除这个网站吗？")&&d("delete")},T=()=>{console.warn(`Failed to load icon for ${n.website.name}`)};return ce(()=>{v.value&&URL.revokeObjectURL(v.value)}),(h,y)=>(l(),r("div",{onClick:g,class:"website-card"},[e("div",mt,[e("a",{href:s.website.url,target:"_blank",rel:"noopener noreferrer",onClick:y[0]||(y[0]=Q(()=>{},["stop"])),class:"action-btn action-link",title:"访问网站"},[...y[1]||(y[1]=[e("i",{class:"mdi mdi-open-in-new"},null,-1)])],8,pt),e("button",{onClick:Q(w,["stop"]),class:"action-btn",title:"编辑"},[...y[2]||(y[2]=[e("i",{class:"mdi mdi-pencil-outline"},null,-1)])]),e("button",{onClick:Q(o,["stop"]),class:"action-btn action-delete",title:"删除"},[...y[3]||(y[3]=[e("i",{class:"mdi mdi-delete-outline"},null,-1)])])]),e("div",gt,[e("div",yt,[v.value?(l(),r("img",{key:0,src:v.value,alt:s.website.name,class:"website-icon",onError:T},null,40,vt)):(l(),r("div",ft,[...y[4]||(y[4]=[e("i",{class:"mdi mdi-application-outline"},null,-1)])]))]),e("div",bt,[e("h3",wt,K(s.website.name),1),i.value.length>0?(l(),r("div",ht,[(l(!0),r(O,null,W(i.value,t=>(l(),r("span",{key:t,class:"category-tag"},K(t),1))),128))])):L("",!0)])]),e("p",kt,K(s.website.description),1),(s.website.tagIds||[]).length>0?(l(),r("div",Ct,[(l(!0),r(O,null,W((s.website.tagIds||[]).slice(0,4),t=>(l(),r("span",{key:t,class:"hash-tag"}," #"+K(a(t)),1))),128)),(s.website.tagIds?.length||0)>4?(l(),r("span",$t," +"+K(s.website.tagIds.length-4),1)):L("",!0)])):L("",!0)]))}}),xt=z(It,[["__scopeId","data-v-9c55f292"]]),_t=s=>{try{const c=new URL(s);return c.protocol==="http:"||c.protocol==="https:"}catch{return!1}},he=s=>s.length<=8?"****":`${s.slice(0,3)}****${s.slice(-4)}`,ke=async s=>{await navigator.clipboard.writeText(s)},Tt={class:"drawer-header"},At={class:"header-icon"},Ft=["src","alt"],Ut={key:1,class:"site-icon placeholder-icon"},Kt={class:"header-info"},Lt={class:"site-name"},St=["href"],Rt={class:"drawer-body"},Ot={key:0,class:"info-section"},Dt={class:"description-text"},Nt={key:1,class:"info-section"},Mt={class:"categories-row"},Bt={key:2,class:"info-section"},Wt={class:"tags-row"},Et={key:3,class:"info-section"},Vt={class:"section-label"},jt={class:"key-count"},Pt={class:"api-keys-list"},Qt={class:"key-text"},zt=["onClick"],qt=P({__name:"WebsiteDetailDrawer",props:{isOpen:{type:Boolean},website:{}},emits:["close"],setup(s,{emit:c}){const n=s,d=c,{categories:m,loadCategories:f}=te(),{tags:p,loadTags:u}=ie(),v=k(null);le(()=>n.isOpen,async y=>{y&&await Promise.all([f(),u()])});const i=j(()=>{if(!n.website.icon||n.website.icon.byteLength===0)return"";try{const y=new Blob([n.website.icon],{type:n.website.iconMimeType||"image/png"});return URL.createObjectURL(y)}catch(y){return console.error("Failed to create icon URL:",y),""}});j(()=>m.value.find(y=>(n.website.categoryIds||[]).includes(y.id)));const a=j(()=>(n.website.categoryIds||[]).map(y=>m.value.find(t=>t.id===y)?.name).filter(Boolean)),g=y=>p.value.find(I=>I.id===y)?.name||"",w=y=>{try{const t=new URL(y);return t.hostname+(t.pathname!=="/"?t.pathname:"")}catch{return y}},o=()=>{d("close")},T=async y=>{await ke(y),v.value=y,setTimeout(()=>{v.value=null},2e3)},h=()=>{console.warn(`Failed to load icon for ${n.website.name}`)};return ce(()=>{i.value&&URL.revokeObjectURL(i.value)}),(y,t)=>(l(),ee(de,{to:"body"},[N(H,{name:"fade"},{default:J(()=>[s.isOpen?(l(),r("div",{key:0,class:"drawer-backdrop",onClick:o},[N(H,{name:"slide-in-right"},{default:J(()=>[s.isOpen?(l(),r("div",{key:0,class:"drawer-content",onClick:t[0]||(t[0]=Q(()=>{},["stop"]))},[e("div",Tt,[e("div",At,[i.value?(l(),r("img",{key:0,src:i.value,alt:s.website.name,class:"site-icon",onError:h},null,40,Ft)):(l(),r("div",Ut,[...t[1]||(t[1]=[e("i",{class:"mdi mdi-web"},null,-1)])]))]),e("div",Kt,[e("h2",Lt,K(s.website.name),1),e("a",{href:s.website.url,target:"_blank",rel:"noopener noreferrer",class:"site-link"},[V(K(w(s.website.url))+" ",1),t[2]||(t[2]=e("i",{class:"mdi mdi-open-in-new"},null,-1))],8,St)]),e("button",{onClick:o,class:"close-btn"},[...t[3]||(t[3]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Rt,[s.website.description?(l(),r("div",Ot,[t[4]||(t[4]=e("div",{class:"section-label"},[e("i",{class:"mdi mdi-text-box-outline"}),V(" 描述 ")],-1)),e("p",Dt,K(s.website.description),1)])):L("",!0),a.value.length>0?(l(),r("div",Nt,[t[5]||(t[5]=e("div",{class:"section-label"},[e("i",{class:"mdi mdi-folder-outline"}),V(" 分类 ")],-1)),e("div",Mt,[(l(!0),r(O,null,W(a.value,I=>(l(),r("span",{key:I,class:"category-badge"},K(I),1))),128))])])):L("",!0),s.website.tagIds?.length>0?(l(),r("div",Bt,[t[6]||(t[6]=e("div",{class:"section-label"},[e("i",{class:"mdi mdi-tag-multiple-outline"}),V(" 标签 ")],-1)),e("div",Wt,[(l(!0),r(O,null,W(s.website.tagIds,I=>(l(),r("span",{key:I,class:"tag-badge"}," #"+K(g(I)),1))),128))])])):L("",!0),s.website.apiKeys?.length>0?(l(),r("div",Et,[e("div",Vt,[t[7]||(t[7]=e("i",{class:"mdi mdi-key-outline"},null,-1)),t[8]||(t[8]=V(" API Keys ",-1)),e("span",jt,K(s.website.apiKeys.length),1)]),e("div",Pt,[(l(!0),r(O,null,W(s.website.apiKeys,(I,R)=>(l(),r("div",{key:R,class:"api-key-item"},[e("code",Qt,K(D(he)(I)),1),e("button",{onClick:$=>T(I),class:F(["copy-btn",{copied:v.value===I}])},[e("i",{class:F(["mdi",v.value===I?"mdi-check":"mdi-content-copy"])},null,2)],10,zt)]))),128))])])):L("",!0)])])):L("",!0)]),_:1})])):L("",!0)]),_:1})]))}}),Gt=z(qt,[["__scopeId","data-v-e532bd22"]]),Ht={class:"image-uploader"},Jt={key:1,class:"preview-container"},Xt=["src"],Yt={class:"preview-actions"},Zt={key:2,class:"error-message mt-2 text-red-500"},es=P({__name:"ImageUploader",emits:["upload","remove"],setup(s,{emit:c}){const n=c,{selectedFile:d,previewUrl:m,error:f,handleFileSelect:p,processFile:u,reset:v}=Ye(),i=k(null),a=()=>{i.value?.click()},g=async w=>{if(p(w),d.value){const o=await u();o&&n("upload",o)}};return(w,o)=>(l(),r("div",Ht,[D(m)?(l(),r("div",Jt,[e("img",{src:D(m),alt:"预览",class:"preview-image"},null,8,Xt),e("div",Yt,[e("button",{onClick:o[0]||(o[0]=(...T)=>D(v)&&D(v)(...T)),class:"btn btn-danger btn-sm"},[...o[2]||(o[2]=[e("i",{class:"mdi mdi-delete"},null,-1),V(" 删除 ",-1)])]),e("button",{onClick:a,class:"btn btn-secondary btn-sm"},[...o[3]||(o[3]=[e("i",{class:"mdi mdi-upload"},null,-1),V(" 更换 ",-1)])])])])):(l(),r("div",{key:0,onClick:a,class:"upload-zone"},[...o[1]||(o[1]=[e("i",{class:"mdi mdi-cloud-upload text-4xl mb-2"},null,-1),e("p",null,"点击上传图标",-1),e("p",{class:"text-sm text-[var(--text-secondary)] mt-1"},"推荐尺寸：128-256px，建议小于500KB",-1)])])),e("input",{ref_key:"fileInput",ref:i,type:"file",accept:"image/*",class:"hidden",onChange:g},null,544),D(f)?(l(),r("p",Zt,K(D(f)),1)):L("",!0)]))}}),ts=z(es,[["__scopeId","data-v-42b4edd4"]]),ss=()=>{const s=k(null),c=k(!1);return{copiedKey:s,isCopying:c,maskKey:m=>he(m),copyKey:async m=>{c.value=!0;try{await ke(m),s.value=m,setTimeout(()=>{s.value=null},2e3)}catch(f){console.error("Failed to copy API key:",f)}finally{c.value=!1}}}},os={class:"api-key-input"},ns={class:"space-y-2"},as={class:"flex-1 font-mono text-sm"},ls={class:"flex gap-2"},is=["onClick","disabled"],rs=["onClick"],cs={class:"mt-2 flex gap-2"},ds=["onKeydown"],us=P({__name:"ApiKeyInput",props:{modelValue:{}},emits:["update:modelValue"],setup(s,{expose:c,emit:n}){const d=s,m=n,{copiedKey:f,isCopying:p,maskKey:u,copyKey:v}=ss(),i=k([]),a=k("");le(()=>d.modelValue,T=>{T&&(i.value=[...T])},{immediate:!0,deep:!0});const g=()=>{const T=a.value.trim();if(T){const h=[...i.value,T];i.value=h,a.value="",m("update:modelValue",h)}},w=T=>{const h=i.value.filter((y,t)=>t!==T);i.value=h,m("update:modelValue",h)};return c({getAllKeys:()=>{const T=a.value.trim();return T?[...i.value,T]:[...i.value]}}),(T,h)=>(l(),r("div",os,[h[3]||(h[3]=e("label",{class:"block text-sm font-medium mb-2"},"API Keys",-1)),e("div",ns,[(l(!0),r(O,null,W(i.value,(y,t)=>(l(),r("div",{key:t,class:"api-key-item flex items-center gap-2"},[e("span",as,K(D(u)(y)),1),e("div",ls,[e("button",{type:"button",onClick:I=>D(v)(y),class:F(["btn btn-sm",D(f)===y?"text-green-500":"btn-secondary"]),disabled:D(p)},[e("i",{class:F(["mdi",D(f)===y?"mdi-check":"mdi-content-copy"])},null,2)],10,is),e("button",{type:"button",onClick:I=>w(t),class:"btn btn-sm btn-danger"},[...h[1]||(h[1]=[e("i",{class:"mdi mdi-delete"},null,-1)])],8,rs)])]))),128))]),e("div",cs,[G(e("input",{"onUpdate:modelValue":h[0]||(h[0]=y=>a.value=y),type:"password",placeholder:"输入新的API Key",class:"input flex-1",id:"api-key-input",onKeydown:X(Q(g,["prevent"]),["enter"])},null,40,ds),[[Y,a.value]]),e("button",{type:"button",onClick:g,class:"btn btn-primary"},[...h[2]||(h[2]=[e("i",{class:"mdi mdi-plus"},null,-1),V(" 添加 ",-1)])])])]))}}),ms=z(us,[["__scopeId","data-v-a980d05e"]]),ps={class:"website-form"},gs={class:"text-2xl font-bold mb-6"},ys={key:0,class:"selected-items"},vs=["onClick"],fs={key:1,class:"placeholder"},bs={key:0,class:"multi-select-dropdown"},ws=["onClick"],hs={class:"item-name"},ks={key:0,class:"mdi mdi-check check-icon"},Cs={key:0,class:"dropdown-empty"},$s={class:"flex flex-wrap gap-2"},Is=["value"],xs={class:"tag-label"},_s={class:"flex gap-3 pt-4"},Ts=["disabled"],be=P({__name:"WebsiteForm",props:{website:{}},emits:["submit","cancel"],setup(s,{emit:c}){const n=s,d=c,{categories:m,loadCategories:f}=te(),{tags:p,loadTags:u}=ie(),v=j(()=>!!n.website),i=k(!1),a=k(null),g=k(!1),w=k(null),o=ge({name:"",url:"",icon:new ArrayBuffer(0),iconMimeType:"",description:"",categoryIds:[],tagIds:[],apiKeys:[]});Z(()=>{f(),u(),document.addEventListener("click",T)}),ce(()=>{document.removeEventListener("click",T)});const T=C=>{w.value&&!w.value.contains(C.target)&&(g.value=!1)},h=()=>{g.value=!g.value},y=C=>{const b=o.categoryIds.indexOf(C);b===-1?o.categoryIds.push(C):o.categoryIds.splice(b,1)},t=C=>{const b=o.categoryIds.indexOf(C);b!==-1&&o.categoryIds.splice(b,1)},I=C=>m.value.find(b=>b.id===C)?.name||"",R=C=>m.value.find(b=>b.id===C)?.iconName||"folder";le(()=>n.website,C=>{C?(o.name=C.name,o.url=C.url,o.icon=C.icon,o.iconMimeType=C.iconMimeType,o.description=C.description,o.categoryIds=[...C.categoryIds||[]],o.tagIds=[...C.tagIds||[]],o.apiKeys=[...C.apiKeys||[]]):(o.name="",o.url="",o.icon=new ArrayBuffer(0),o.iconMimeType="",o.description="",o.categoryIds=[],o.tagIds=[],o.apiKeys=[])},{immediate:!0});const $=C=>{o.icon=C.buffer,o.iconMimeType=C.mimeType},B=()=>{o.icon=new ArrayBuffer(0),o.iconMimeType=""},q=async()=>{if(!_t(o.url)){alert("请输入有效的URL");return}if(o.categoryIds.length===0){alert("请至少选择一个分类");return}i.value=!0;try{const C=a.value?.getAllKeys()||[...o.apiKeys],b=Te(o),U={name:b.name,url:b.url,icon:b.icon,iconMimeType:b.iconMimeType,description:b.description,categoryIds:[...b.categoryIds],tagIds:[...b.tagIds],apiKeys:C};d("submit",U)}finally{i.value=!1}},M=()=>{d("cancel")},_=C=>{o.apiKeys=[...C]};return(C,b)=>(l(),r("div",ps,[e("h2",gs,K(v.value?"编辑网站":"添加网站"),1),e("form",{onSubmit:Q(q,["prevent"]),class:"space-y-4"},[e("div",null,[b[4]||(b[4]=e("label",{class:"block text-sm font-medium mb-2"},"网站名称 *",-1)),G(e("input",{"onUpdate:modelValue":b[0]||(b[0]=U=>o.name=U),type:"text",placeholder:"例如：ChatGPT",class:"input",required:""},null,512),[[Y,o.name]])]),e("div",null,[b[5]||(b[5]=e("label",{class:"block text-sm font-medium mb-2"},"网站URL *",-1)),G(e("input",{"onUpdate:modelValue":b[1]||(b[1]=U=>o.url=U),type:"url",placeholder:"https://example.com",class:"input",required:""},null,512),[[Y,o.url]])]),e("div",null,[b[6]||(b[6]=e("label",{class:"block text-sm font-medium mb-2"},"图标",-1)),N(ts,{onUpload:$,onRemove:B})]),e("div",null,[b[7]||(b[7]=e("label",{class:"block text-sm font-medium mb-2"},"描述",-1)),G(e("textarea",{"onUpdate:modelValue":b[2]||(b[2]=U=>o.description=U),placeholder:"网站功能描述...",class:"input",rows:"3"},null,512),[[Y,o.description]])]),e("div",null,[b[9]||(b[9]=e("label",{class:"block text-sm font-medium mb-2"},"分类 *",-1)),e("div",{class:"multi-select",ref_key:"categorySelectRef",ref:w},[e("div",{class:F(["multi-select-trigger",{"has-value":o.categoryIds.length>0}]),onClick:h},[o.categoryIds.length>0?(l(),r("div",ys,[(l(!0),r(O,null,W(o.categoryIds,U=>(l(),r("span",{key:U,class:"selected-tag"},[e("i",{class:F(["mdi",`mdi-${R(U)}`])},null,2),V(" "+K(I(U))+" ",1),e("button",{type:"button",onClick:Q(se=>t(U),["stop"]),class:"remove-tag"},[...b[8]||(b[8]=[e("i",{class:"mdi mdi-close"},null,-1)])],8,vs)]))),128))])):(l(),r("span",fs,"选择分类（可多选）")),e("i",{class:F(["mdi mdi-chevron-down dropdown-icon",{rotate:g.value}])},null,2)],2),N(H,{name:"dropdown"},{default:J(()=>[g.value?(l(),r("div",bs,[(l(!0),r(O,null,W(D(m),U=>(l(),r("div",{key:U.id,class:F(["dropdown-item",{selected:o.categoryIds.includes(U.id)}]),onClick:se=>y(U.id)},[e("i",{class:F(["mdi",`mdi-${U.iconName}`,"item-icon"])},null,2),e("span",hs,K(U.name),1),o.categoryIds.includes(U.id)?(l(),r("i",ks)):L("",!0)],10,ws))),128)),D(m).length===0?(l(),r("div",Cs," 暂无分类 ")):L("",!0)])):L("",!0)]),_:1})],512)]),e("div",null,[b[10]||(b[10]=e("label",{class:"block text-sm font-medium mb-2"},"标签",-1)),e("div",$s,[(l(!0),r(O,null,W(D(p),U=>(l(),r("label",{key:U.id,class:"tag-checkbox"},[G(e("input",{type:"checkbox",value:U.id,"onUpdate:modelValue":b[3]||(b[3]=se=>o.tagIds=se),class:"hidden"},null,8,Is),[[_e,o.tagIds]]),e("span",xs,K(U.name),1)]))),128))])]),N(ms,{ref_key:"apiKeyInputRef",ref:a,modelValue:o.apiKeys,"onUpdate:modelValue":_},null,8,["modelValue"]),e("div",_s,[e("button",{type:"submit",class:"btn btn-primary flex-1",disabled:i.value},[e("i",{class:F(["mdi",i.value?"mdi-loading mdi-spin":"mdi-content-save-all"])},null,2),V(" "+K(i.value?"保存中...":v.value?"保存":"添加"),1)],8,Ts),e("button",{type:"button",onClick:M,class:"btn btn-secondary"}," 取消 ")])],32)]))}}),As={class:"modal-body"},Fs={class:"items-container"},Us={class:"edit-row"},Ks=["disabled"],Ls={key:0,class:"icon-picker"},Ss=["onClick"],Rs={class:"item-content"},Os={class:"item-icon"},Ds={class:"item-name"},Ns={class:"item-actions"},Ms=["onClick"],Bs=["onClick"],Ws={class:"edit-row"},Es={key:0,class:"icon-picker"},Vs=["onClick"],js=P({__name:"CategoryManageModal",props:{isOpen:{type:Boolean}},emits:["close"],setup(s,{emit:c}){const n=s,d=c,{categories:m,loadCategories:f,addCategory:p,updateCategory:u,deleteCategory:v}=te(),i=k(null),a=k(!1),g=k(null),w=k(null),o=ge({name:"",iconName:"folder"}),T=["robot","robot-outline","brain","head-snowflake","memory","chip","creation","creation-outline","auto-fix","lightning-bolt","atom","atom-variant","raspberry-pi","cpu-32-bit","cpu-64-bit","expansion-card","image","image-outline","image-multiple","image-edit","camera","camera-outline","video","video-outline","movie","movie-open","movie-outline","filmstrip","music","music-note","microphone","microphone-outline","headphones","speaker","code-tags","code-braces","code-brackets","code-json","xml","script","language-javascript","language-typescript","language-python","language-java","language-html5","language-css3","language-go","language-rust","git","github","gitlab","source-branch","source-merge","api","webhook","console","console-line","terminal","powershell","bug","bug-outline","test-tube","flask","flask-outline","chart-line","chart-bar","chart-pie","chart-donut","chart-areaspline","chart-timeline","chart-scatter-plot","poll","finance","trending-up","database","database-outline","table","view-list","clipboard-list","calculator","calculator-variant","sigma","function","matrix","palette","palette-outline","brush","brush-outline","pencil","pencil-outline","format-paint","draw","drawing","drawing-box","vector-square","shape","shape-outline","layers","layers-outline","puzzle","puzzle-outline","lightbulb","lightbulb-outline","lightbulb-on","lightbulb-on-outline","file-document","file-document-outline","file-pdf-box","file-word","file-excel","notebook","notebook-outline","note-text","note-text-outline","text-box","format-text","format-quote-close","translate","alphabetical","spellcheck","clipboard-text","clipboard-text-outline","content-copy","content-paste","web","earth","google-chrome","firefox","microsoft-edge","cloud","cloud-outline","cloud-download","cloud-upload","cloud-sync","server","server-network","dns","wifi","access-point","lan","lan-connect","router-wireless","ethernet","ip-network","folder","folder-outline","folder-open","folder-multiple","folder-star","bookmark","bookmark-outline","bookshelf","tag","tag-outline","label","label-outline","archive","package","package-variant","inbox","inbox-full","tray-full","briefcase","briefcase-outline","email","email-outline","gmail","chat","chat-outline","forum","forum-outline","message","message-outline","comment-text","phone","phone-outline","cellphone","send","share","share-variant","rss","broadcast","antenna","bell","cog","cog-outline","cogs","wrench","wrench-outline","hammer","hammer-wrench","tools","toolbox","toolbox-outline","tune","tune-vertical","screwdriver","application-cog","account-cog","school","school-outline","book","book-open","book-open-outline","book-multiple","library","certificate","certificate-outline","diploma","graduation-cap","human-male-board","teach","trophy","trophy-outline","medal","medal-outline","counter","abacus","brain","star","star-outline","star-circle","heart","heart-outline","thumb-up","thumb-up-outline","thumb-down","fire","flash","flash-outline","diamond","diamond-outline","crown","crown-outline","flag","flag-outline","pin","pin-outline","target","shield","shield-outline","shield-check","shield-lock","lock","lock-outline","lock-open","key","key-outline","key-variant","fingerprint","eye","eye-outline","eye-off","incognito","security","passport","id-card","account-key","two-factor-authentication","cart","cart-outline","store","storefront","shopping","cash","cash-multiple","credit-card","credit-card-outline","wallet","wallet-outline","gift","gift-outline","sale","percent","currency-usd","currency-eur","currency-cny","bitcoin","ethereum","hospital-box","medical-bag","pill","needle","stethoscope","food","food-apple","coffee","coffee-outline","glass-mug-variant","silverware-fork-knife","run","walk","bike","yoga","meditation","spa","flower","leaf","tree","gamepad-variant","controller-classic","puzzle","dice-multiple","cards","chess-knight","poker-chip","slot-machine","party-popper","balloon","emoticon","emoticon-happy","emoticon-cool","drama-masks","theater","airplane","car","bus","train","subway","ferry","earth","map","map-marker","compass","home","home-outline","office-building","city","beach","apps","view-grid","view-dashboard","dots-grid","infinity","link","link-variant","attachment","paperclip","magnet","download","upload","sync","refresh","cached","timer","clock","clock-outline","calendar","calendar-outline","alarm","bell-outline","bullhorn","information","help-circle"];Z(()=>{f()}),le(()=>n.isOpen,M=>{M?f():t()});const h=()=>{i.value="new",o.name="",o.iconName="folder",a.value=!1,re(()=>{w.value?.focus()})},y=M=>{i.value=M.id,o.name=M.name,o.iconName=M.iconName,a.value=!1,re(()=>{(Array.isArray(g.value)?g.value[0]:g.value)?.focus()})},t=()=>{i.value=null,o.name="",o.iconName="folder",a.value=!1},I=()=>{a.value=!a.value},R=M=>{o.iconName=M,a.value=!1},$=async()=>{if(o.name.trim())try{i.value==="new"?await p({name:o.name.trim(),iconName:o.iconName}):i.value&&await u(i.value,{name:o.name.trim(),iconName:o.iconName}),t()}catch(M){console.error("Failed to save category:",M),alert("保存失败")}},B=async M=>{if(confirm(`确定要删除"${M.name}"吗？`))try{await v(M.id)}catch(_){console.error("Failed to delete category:",_),alert("删除失败")}},q=()=>{t(),d("close")};return(M,_)=>(l(),ee(de,{to:"body"},[N(H,{name:"fade"},{default:J(()=>[s.isOpen?(l(),r("div",{key:0,class:"modal-backdrop",onClick:q},[N(H,{name:"scale"},{default:J(()=>[s.isOpen?(l(),r("div",{key:0,class:"modal-content",onClick:_[2]||(_[2]=Q(()=>{},["stop"]))},[e("div",{class:"modal-header"},[_[4]||(_[4]=e("h2",null,"分类管理",-1)),e("button",{onClick:q,class:"close-btn"},[..._[3]||(_[3]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",As,[e("div",Fs,[e("div",{class:F(["item add-item",{"is-editing":i.value==="new"}])},[i.value!=="new"?(l(),r("button",{key:0,onClick:h,class:"add-trigger"},[..._[5]||(_[5]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"添加分类",-1)])])):(l(),r(O,{key:1},[e("div",Us,[e("div",{class:"icon-picker-trigger",onClick:I},[e("i",{class:F(["mdi",`mdi-${o.iconName}`])},null,2),_[6]||(_[6]=e("i",{class:"mdi mdi-chevron-down picker-arrow"},null,-1))]),G(e("input",{"onUpdate:modelValue":_[0]||(_[0]=C=>o.name=C),type:"text",class:"edit-input",placeholder:"输入分类名称",onKeyup:[X($,["enter"]),X(t,["escape"])],ref_key:"addInputRef",ref:w},null,544),[[Y,o.name]]),e("button",{onClick:$,class:"action-btn confirm",disabled:!o.name.trim()},[..._[7]||(_[7]=[e("i",{class:"mdi mdi-check"},null,-1)])],8,Ks),e("button",{onClick:t,class:"action-btn cancel"},[..._[8]||(_[8]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),N(H,{name:"dropdown"},{default:J(()=>[a.value?(l(),r("div",Ls,[(l(),r(O,null,W(T,C=>e("div",{key:C,onClick:b=>R(C),class:F(["icon-option",o.iconName===C?"selected":""])},[e("i",{class:F(["mdi",`mdi-${C}`])},null,2)],10,Ss)),64))])):L("",!0)]),_:1})],64))],2),(l(!0),r(O,null,W(D(m),C=>(l(),r("div",{key:C.id,class:F(["item",{"is-editing":i.value===C.id}])},[i.value!==C.id?(l(),r(O,{key:0},[e("div",Rs,[e("div",Os,[e("i",{class:F(["mdi",`mdi-${C.iconName}`])},null,2)]),e("span",Ds,K(C.name),1)]),e("div",Ns,[e("button",{onClick:b=>y(C),class:"action-btn edit"},[..._[9]||(_[9]=[e("i",{class:"mdi mdi-pencil-outline"},null,-1)])],8,Ms),e("button",{onClick:b=>B(C),class:"action-btn delete"},[..._[10]||(_[10]=[e("i",{class:"mdi mdi-delete-outline"},null,-1)])],8,Bs)])],64)):(l(),r(O,{key:1},[e("div",Ws,[e("div",{class:"icon-picker-trigger",onClick:I},[e("i",{class:F(["mdi",`mdi-${o.iconName}`])},null,2),_[11]||(_[11]=e("i",{class:"mdi mdi-chevron-down picker-arrow"},null,-1))]),G(e("input",{"onUpdate:modelValue":_[1]||(_[1]=b=>o.name=b),type:"text",class:"edit-input",placeholder:"分类名称",onKeyup:[X($,["enter"]),X(t,["escape"])],ref_for:!0,ref_key:"editInputRef",ref:g},null,544),[[Y,o.name]]),e("button",{onClick:$,class:"action-btn confirm"},[..._[12]||(_[12]=[e("i",{class:"mdi mdi-check"},null,-1)])]),e("button",{onClick:t,class:"action-btn cancel"},[..._[13]||(_[13]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),N(H,{name:"dropdown"},{default:J(()=>[a.value?(l(),r("div",Es,[(l(),r(O,null,W(T,b=>e("div",{key:b,onClick:U=>R(b),class:F(["icon-option",o.iconName===b?"selected":""])},[e("i",{class:F(["mdi",`mdi-${b}`])},null,2)],10,Vs)),64))])):L("",!0)]),_:1})],64))],2))),128))])])])):L("",!0)]),_:1})])):L("",!0)]),_:1})]))}}),Ps=z(js,[["__scopeId","data-v-e6256507"]]),Qs={class:"modal-body"},zs={class:"items-container"},qs={key:1,class:"edit-row"},Gs=["disabled"],Hs={class:"item-content"},Js={class:"item-name"},Xs={class:"item-actions"},Ys=["onClick"],Zs=["onClick"],eo={key:1,class:"edit-row"},to=P({__name:"TagManageModal",props:{isOpen:{type:Boolean}},emits:["close"],setup(s,{emit:c}){const n=s,d=c,{tags:m,loadTags:f,addTag:p,updateTag:u,deleteTag:v}=ie(),i=k(null),a=k(null),g=k(null),w=ge({name:""});Z(()=>{f()}),le(()=>n.isOpen,R=>{R?f():h()});const o=()=>{i.value="new",w.name="",re(()=>{g.value?.focus()})},T=R=>{i.value=R.id,w.name=R.name,re(()=>{(Array.isArray(a.value)?a.value[0]:a.value)?.focus()})},h=()=>{i.value=null,w.name=""},y=async()=>{if(w.name.trim())try{if(i.value==="new")await p({name:w.name.trim(),count:0});else if(i.value){const R=m.value.find($=>$.id===i.value);await u(i.value,{name:w.name.trim(),count:R?.count||0})}h()}catch(R){console.error("Failed to save tag:",R),alert("保存失败")}},t=async R=>{if(confirm(`确定要删除"${R.name}"吗？`))try{await v(R.id)}catch($){console.error("Failed to delete tag:",$),alert("删除失败")}},I=()=>{h(),d("close")};return(R,$)=>(l(),ee(de,{to:"body"},[N(H,{name:"fade"},{default:J(()=>[s.isOpen?(l(),r("div",{key:0,class:"modal-backdrop",onClick:I},[N(H,{name:"scale"},{default:J(()=>[s.isOpen?(l(),r("div",{key:0,class:"modal-content",onClick:$[2]||($[2]=Q(()=>{},["stop"]))},[e("div",{class:"modal-header"},[$[4]||($[4]=e("h2",null,"标签管理",-1)),e("button",{onClick:I,class:"close-btn"},[...$[3]||($[3]=[e("i",{class:"mdi mdi-close"},null,-1)])])]),e("div",Qs,[e("div",zs,[e("div",{class:F(["item add-item",{"is-editing":i.value==="new"}])},[i.value!=="new"?(l(),r("button",{key:0,onClick:o,class:"add-trigger"},[...$[5]||($[5]=[e("i",{class:"mdi mdi-plus"},null,-1),e("span",null,"添加标签",-1)])])):(l(),r("div",qs,[$[8]||($[8]=e("span",{class:"hash-prefix"},"#",-1)),G(e("input",{"onUpdate:modelValue":$[0]||($[0]=B=>w.name=B),type:"text",class:"edit-input",placeholder:"输入标签名称",onKeyup:[X(y,["enter"]),X(h,["escape"])],ref_key:"addInputRef",ref:g},null,544),[[Y,w.name]]),e("button",{onClick:y,class:"action-btn confirm",disabled:!w.name.trim()},[...$[6]||($[6]=[e("i",{class:"mdi mdi-check"},null,-1)])],8,Gs),e("button",{onClick:h,class:"action-btn cancel"},[...$[7]||($[7]=[e("i",{class:"mdi mdi-close"},null,-1)])])]))],2),(l(!0),r(O,null,W(D(m),B=>(l(),r("div",{key:B.id,class:F(["item",{"is-editing":i.value===B.id}])},[i.value!==B.id?(l(),r(O,{key:0},[e("div",Hs,[e("span",Js,"#"+K(B.name),1)]),e("div",Xs,[e("button",{onClick:q=>T(B),class:"action-btn edit"},[...$[9]||($[9]=[e("i",{class:"mdi mdi-pencil-outline"},null,-1)])],8,Ys),e("button",{onClick:q=>t(B),class:"action-btn delete"},[...$[10]||($[10]=[e("i",{class:"mdi mdi-delete-outline"},null,-1)])],8,Zs)])],64)):(l(),r("div",eo,[$[13]||($[13]=e("span",{class:"hash-prefix"},"#",-1)),G(e("input",{"onUpdate:modelValue":$[1]||($[1]=q=>w.name=q),type:"text",class:"edit-input",placeholder:"标签名称",onKeyup:[X(y,["enter"]),X(h,["escape"])],ref_for:!0,ref_key:"editInputRef",ref:a},null,544),[[Y,w.name]]),e("button",{onClick:y,class:"action-btn confirm"},[...$[11]||($[11]=[e("i",{class:"mdi mdi-check"},null,-1)])]),e("button",{onClick:h,class:"action-btn cancel"},[...$[12]||($[12]=[e("i",{class:"mdi mdi-close"},null,-1)])])]))],2))),128))])])])):L("",!0)]),_:1})])):L("",!0)]),_:1})]))}}),so=z(to,[["__scopeId","data-v-0a8d2347"]]),oo={class:"main-content"},no={class:"content-wrapper"},ao={class:"content-header"},lo={class:"text-2xl font-bold"},io={key:0,class:"loading-container"},ro={key:1,class:"empty-state"},co={key:2,class:"websites-grid"},uo={key:1,class:"modal-backdrop"},mo={class:"modal-content"},po={class:"modal-scroll-area"},go=P({__name:"MainContent",setup(s,{expose:c}){const{websites:n,isLoading:d,loadWebsites:m,addWebsite:f,updateWebsite:p,deleteWebsite:u}=we(),{categories:v,loadCategories:i}=te(),{loadTags:a}=ie(),g=ye(),w=k(null),o=k(null),T=k(!1),h=k(!1),y=k(!1),t=k(!1),I=k(!1);Z(async()=>{await Promise.all([m(),i(),a()])}),c({openModal:S=>{switch(S){case"website":h.value=!0;break;case"category":t.value=!0;break;case"tag":I.value=!0;break}}});const $=j(()=>g.filter.searchQuery?`搜索: "${g.filter.searchQuery}"`:g.filter.categoryId&&v.value.find(A=>A.id===g.filter.categoryId)?.name||"全部网站"),B=j(()=>{let S=[...n.value];if(g.filter.searchQuery){const A=g.filter.searchQuery.toLowerCase();S=S.filter(E=>E.name.toLowerCase().includes(A)||E.description.toLowerCase().includes(A)||E.url.toLowerCase().includes(A))}return g.filter.categoryId&&(S=S.filter(A=>(A.categoryIds||[]).includes(g.filter.categoryId))),g.filter.tagIds.length>0&&(S=S.filter(A=>g.filter.tagIds.some(E=>(A.tagIds||[]).includes(E)))),S}),q=j(()=>!!g.filter.searchQuery),M=()=>{g.resetFilter()},_=S=>{w.value=S,T.value=!0},C=()=>{T.value=!1},b=async S=>{try{await f(S),oe()}catch(A){console.error("Failed to add website:",A),alert("添加网站失败")}},U=S=>{o.value=S,y.value=!0},se=async S=>{try{await u(S.id)}catch(A){console.error("Failed to delete website:",A),alert("删除网站失败")}},$e=async S=>{if(o.value?.id)try{await p(o.value.id,S),oe()}catch(A){console.error("Failed to update website:",A),alert("更新网站失败")}},oe=()=>{h.value=!1,y.value=!1,o.value=null};return(S,A)=>(l(),r("main",oo,[e("div",no,[e("div",ao,[e("h1",lo,K($.value),1)]),D(d)?(l(),r("div",io,[...A[2]||(A[2]=[e("i",{class:"mdi mdi-loading mdi-spin text-4xl"},null,-1),e("p",{class:"mt-2"},"加载中...",-1)])])):B.value.length===0?(l(),r("div",ro,[A[4]||(A[4]=e("i",{class:"mdi mdi-folder-multiple text-6xl text-[var(--text-secondary)]"},null,-1)),A[5]||(A[5]=e("p",{class:"text-[var(--text-secondary)] mt-4"},"还没有对应网站，点击右上角按钮添加第一个网站吧",-1)),q.value?(l(),r("button",{key:0,onClick:M,class:"btn btn-secondary mt-4"},[...A[3]||(A[3]=[e("i",{class:"mdi mdi-filter-remove-outline"},null,-1),V(" 清除筛选 ",-1)])])):L("",!0)])):(l(),r("div",co,[(l(!0),r(O,null,W(B.value,(E,Ie)=>(l(),ee(xt,{key:E.id,website:E,class:F(`stagger-${Ie%6+1}`),onClick:ve=>_(E),onEdit:ve=>U(E),onDelete:ve=>se(E)},null,8,["website","class","onClick","onEdit","onDelete"]))),128))]))]),w.value?(l(),ee(Gt,{key:0,"is-open":T.value,website:w.value,onClose:C},null,8,["is-open","website"])):L("",!0),h.value||y.value?(l(),r("div",uo,[e("div",mo,[e("button",{onClick:oe,class:"close-modal-btn"},[...A[6]||(A[6]=[e("i",{class:"mdi mdi-close text-xl"},null,-1)])]),e("div",po,[h.value?(l(),ee(be,{key:0,onSubmit:b,onCancel:oe})):(l(),ee(be,{key:1,website:o.value,onSubmit:$e,onCancel:oe},null,8,["website"]))])])])):L("",!0),N(Ps,{"is-open":t.value,onClose:A[0]||(A[0]=E=>t.value=!1)},null,8,["is-open"]),N(so,{"is-open":I.value,onClose:A[1]||(A[1]=E=>I.value=!1)},null,8,["is-open"])]))}}),yo=z(go,[["__scopeId","data-v-255697bb"]]),vo=[{name:"大模型",iconName:"robot"},{name:"图像生成",iconName:"image"},{name:"编程助手",iconName:"code-tags"},{name:"音频/语音",iconName:"volume-high"},{name:"视频生成",iconName:"movie-open"},{name:"数据分析",iconName:"chart-line"},{name:"文本处理",iconName:"format-text"}],fo=[{name:"免费",count:0},{name:"付费",count:0},{name:"中文界面",count:0},{name:"英文界面",count:0},{name:"需要注册",count:0},{name:"无需注册",count:0},{name:"开源",count:0},{name:"闭源",count:0},{name:"无需APIKey",count:0}],Ce=async()=>{await x.categories.count()===0&&(await x.categories.bulkAdd(vo),console.log("Categories seeded")),await x.tags.count()===0&&(await x.tags.bulkAdd(fo),console.log("Tags seeded"))},bo=()=>{const s=k(!1),c=async()=>{try{await x.open(),await Ce(),s.value=!0}catch(n){console.error("Failed to initialize database:",n)}};return Z(()=>{c()}),{db:x,isReady:s}},wo={class:"app-body"},ho=P({__name:"App",setup(s){bo();const{currentTheme:c}=Ke(),n=k(!1),d=k(null),m=()=>{n.value=!n.value},f=p=>{d.value?.openModal(p)};return(p,u)=>(l(),r("div",{class:F(["app",`${D(c)}-theme`])},[N(Ge,{onToggleSidebar:m,onAction:f}),e("div",wo,[N(dt,{"is-open":n.value,onClose:u[0]||(u[0]=v=>n.value=!1)},null,8,["is-open"]),N(yo,{ref_key:"mainContentRef",ref:d},null,512)])],2))}}),pe=Ae(ho),ko=Fe();pe.use(ko);Ce().then(()=>{pe.mount("#app")}).catch(s=>{console.error("Failed to seed database:",s),pe.mount("#app")});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("SW registered: ",s)}).catch(s=>{console.log("SW registration failed: ",s)})});
